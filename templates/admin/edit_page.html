{% extends "admin/base.html" %}

{% block title %}{% if lang == 'fr' %}Modifier{{ else }}Edit{% endif %} {{ page.title }}{% endblock %}
{% block page_title %}{% if lang == 'fr' %}Modifier{% else %}Edit{% endif %}: {{ page.title }}{% endblock %}

{% block content %}
<style>
.image-preview {
    max-width: 200px;
    max-height: 150px;
    border-radius: 8px;
}
.resolution-badge {
    background: #10b981;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
}
</style>

<div class="mb-6 flex justify-between items-center">
    <a href="/admin/pages" class="text-accent hover:text-primary font-semibold">‚Üê {% if lang == 'fr' %}Retour aux pages{% else %}Back to Pages{% endif %}</a>
    <div class="flex gap-2">
        <button onclick="setLang('fr')" class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 {% if lang == 'fr' %}bg-accent text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            FR
        </button>
        <button onclick="setLang('en')" class="px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 {% if lang == 'en' %}bg-accent text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            EN
        </button>
    </div>
</div>

<div class="bg-white rounded-lg shadow p-6 mb-8">
    <h3 class="text-xl font-bold text-primary mb-6">{% if lang == 'fr' %}Param√®tres de la Page & SEO{% else %}Page Settings & SEO{% endif %}</h3>
    <form method="POST" action="/admin/page/{{ page.id }}/update" class="space-y-4">
        <input type="hidden" name="lang" value="{{ lang }}">
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                {% if lang == 'fr' %}Titre de la page{% else %}Page Title{% endif %}
            </label>
            <input type="text" name="title" value="{{ page.title }}" required 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-accent focus:outline-none">
        </div>
        
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Meta Description (SEO)
                <span class="text-xs text-gray-500 ml-2">{% if lang == 'fr' %}Recommand√©: 150-160 caract√®res{% else %}Recommended: 150-160 characters{% endif %}</span>
            </label>
            <textarea name="meta_description" rows="2" maxlength="160"
                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-accent focus:outline-none">{{ page.meta_description }}</textarea>
            <p class="text-xs text-gray-500 mt-1">
                {% if lang == 'fr' %}Cette description appara√Æt dans les r√©sultats de recherche Google{% else %}This description appears in Google search results{% endif %}
            </p>
        </div>
        
        <div class="flex items-center">
            <input type="checkbox" name="is_active" id="page_active" {{ 'checked' if page.is_active }} 
                   class="w-4 h-4 text-accent border-gray-300 rounded focus:ring-accent">
            <label for="page_active" class="ml-2 text-sm font-semibold text-gray-700">
                {% if lang == 'fr' %}Page active{% else %}Page Active{% endif %}
            </label>
        </div>
        
        <button type="submit" class="bg-accent text-white px-6 py-3 rounded-full hover:bg-primary transition-colors font-semibold">
            {% if lang == 'fr' %}Mettre √† jour{% else %}Update Page Settings{% endif %}
        </button>
    </form>
</div>

<div class="bg-white rounded-lg shadow p-6 mb-8">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-primary">
            {% if lang == 'fr' %}Sections de la page{% else %}Page Sections{% endif %}
        </h3>
        <div class="flex gap-3">
            <select id="languageFilter" onchange="filterSections()" class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                <option value="all">{% if lang == 'fr' %}Toutes les langues{% else %}All Languages{% endif %}</option>
                <option value="fr">Fran√ßais</option>
                <option value="en">English</option>
            </select>
            <button onclick="showAddSection()" class="bg-accent text-white px-4 py-2 rounded-full hover:bg-primary transition-colors text-sm font-semibold">
                + {% if lang == 'fr' %}Ajouter une section{% else %}Add Section{% endif %}
            </button>
        </div>
    </div>
    
    <div id="addSectionForm" class="hidden mb-6 p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-200">
        <h4 class="font-bold text-lg mb-4 text-blue-900">{% if lang == 'fr' %}Nouvelle section{% else %}Add New Section{% endif %}</h4>
        <form method="POST" action="/admin/section/create" class="space-y-4">
            <input type="hidden" name="page_id" value="{{ page.id }}">
            <input type="hidden" name="lang" value="{{ lang }}">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if lang == 'fr' %}Type de section{% else %}Section Type{% endif %}
                    </label>
                    <select name="section_type" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
                        <option value="text">Text</option>
                        <option value="hero">Hero</option>
                        <option value="service">Service</option>
                        <option value="contact">Contact</option>
                        <option value="features">Features</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if lang == 'fr' %}Langue{% else %}Language{% endif %}
                    </label>
                    <select name="language_code" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    {% if lang == 'fr' %}Titre{% else %}Heading{% endif %}
                </label>
                <input type="text" name="heading" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
            </div>
            
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    {% if lang == 'fr' %}Contenu{% else %}Content{% endif %}
                </label>
                <textarea name="content" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none"></textarea>
            </div>
            
            <div class="flex gap-2">
                <button type="submit" class="bg-accent text-white px-6 py-3 rounded-full hover:bg-primary transition-colors text-sm font-semibold">
                    {% if lang == 'fr' %}Cr√©er la section{% else %}Create Section{% endif %}
                </button>
                <button type="button" onclick="hideAddSection()" class="bg-gray-300 text-gray-700 px-6 py-3 rounded-full hover:bg-gray-400 transition-colors text-sm font-semibold">
                    {% if lang == 'fr' %}Annuler{% else %}Cancel{% endif %}
                </button>
            </div>
        </form>
    </div>
    
    <div class="space-y-6">
        {% for section in sections %}
        <div class="section-item border-2 {{ 'border-green-300 bg-green-50' if section.is_active else 'border-gray-200 bg-gray-50 opacity-60' }} rounded-lg p-6" data-language="{{ section.language_code }}">
            <div class="flex justify-between items-start mb-4">
                <div class="flex gap-2">
                    <span class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 py-1 rounded-full text-xs font-bold uppercase">{{ section.section_type }}</span>
                    <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-xs font-bold">{{ section.language_code.upper() }}</span>
                    <span class="px-3 py-1 rounded-full text-xs font-bold {{ 'bg-green-500 text-white' if section.is_active else 'bg-gray-400 text-white' }}">
                        {{ '‚úì Active' if section.is_active else '‚úó Inactive' }}
                    </span>
                </div>
                <form method="POST" action="/admin/section/{{ section.id }}/delete" onsubmit="return confirm('{% if lang == 'fr' %}Supprimer cette section ?{% else %}Delete this section?{% endif %}')">
                    <input type="hidden" name="lang" value="{{ lang }}">
                    <button type="submit" class="text-red-600 hover:text-red-800 text-sm font-semibold">üóëÔ∏è {% if lang == 'fr' %}Supprimer{% else %}Delete{% endif %}</button>
                </form>
            </div>
            
            <form method="POST" action="/admin/section/{{ section.id }}/update" class="space-y-4">
                <input type="hidden" name="lang" value="{{ lang }}">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            {% if lang == 'fr' %}Titre principal{% else %}Heading{% endif %}
                        </label>
                        <input type="text" name="heading" value="{{ section.heading or '' }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            {% if lang == 'fr' %}Sous-titre{% else %}Subheading{% endif %}
                        </label>
                        <input type="text" name="subheading" value="{{ section.subheading or '' }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        {% if lang == 'fr' %}Contenu{% else %}Content{% endif %}
                    </label>
                    <textarea name="content" rows="4" 
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">{{ section.content or '' }}</textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            {% if lang == 'fr' %}Texte du bouton{% else %}Button Text{% endif %}
                        </label>
                        <input type="text" name="button_text" value="{{ section.button_text or '' }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            {% if lang == 'fr' %}Lien du bouton{% else %}Button Link{% endif %}
                        </label>
                        <input type="text" name="button_link" value="{{ section.button_link or '' }}" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none"
                               placeholder="/contact">
                    </div>
                </div>
                
                <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                    <h5 class="font-bold text-sm text-blue-900 mb-3">üì∏ {% if lang == 'fr' %}Gestion des images{% else %}Image Management{% endif %}</h5>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                {% if lang == 'fr' %}Image principale{% else %}Main Image{% endif %}
                            </label>
                            <input type="text" name="image_url" value="{{ section.image_url or '' }}" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none" 
                                   placeholder="/static/images/filename.jpg">
                            {% if section.image_url %}
                            <div class="mt-2">
                                <img src="{{ section.image_url }}" alt="Preview" class="image-preview" onerror="this.style.display='none'" onload="showResolution(this, 'res1_{{ section.id }}')">
                                <p id="res1_{{ section.id }}" class="text-xs mt-1"></p>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                {% if lang == 'fr' %}Image d'arri√®re-plan{% else %}Background Image{% endif %}
                            </label>
                            <input type="text" name="background_image" value="{{ section.background_image or '' }}" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:border-accent focus:outline-none" 
                                   placeholder="/static/images/background.jpg">
                            {% if section.background_image %}
                            <div class="mt-2">
                                <img src="{{ section.background_image }}" alt="Preview" class="image-preview" onerror="this.style.display='none'" onload="showResolution(this, 'res2_{{ section.id }}')">
                                <p id="res2_{{ section.id }}" class="text-xs mt-1"></p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <p class="text-xs text-blue-700 font-medium">
                        üí° {% if lang == 'fr' %}R√©solution recommand√©e: 1920x1080px pour les images hero, 800x600px pour les cartes de service{% else %}Recommended resolution: 1920x1080px for hero images, 800x600px for service cards{% endif %}
                    </p>
                </div>
                
                <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" id="section_{{ section.id }}_active" {{ 'checked' if section.is_active }} 
                               class="w-4 h-4 text-accent border-gray-300 rounded">
                        <label for="section_{{ section.id }}_active" class="ml-2 text-sm font-semibold text-gray-700">
                            {% if lang == 'fr' %}Section active{% else %}Section Active{% endif %}
                        </label>
                    </div>
                    
                    <button type="submit" class="bg-accent text-white px-6 py-3 rounded-full hover:bg-primary transition-colors text-sm font-semibold">
                        {% if lang == 'fr' %}üíæ Sauvegarder{% else %}üíæ Update Section{% endif %}
                    </button>
                </div>
            </form>
        </div>
        {% endfor %}
    </div>
</div>

<div class="mt-8 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-6">
    <h3 class="text-lg font-bold text-blue-900 mb-4">üìö {% if lang == 'fr' %}Guide d'utilisation{% else %}Usage Guide{% endif %}</h3>
    <div class="text-sm text-blue-800 space-y-3">
        <div class="bg-white rounded-lg p-3">
            <p class="font-bold mb-1">{% if lang == 'fr' %}üñºÔ∏è Images principales{% else %}üñºÔ∏è Main Images{% endif %}:</p>
            <p>{% if lang == 'fr' %}Pour les images de contenu visibles (photos de services, produits){% else %}For visible content images (service photos, products){% endif %}</p>
        </div>
        
        <div class="bg-white rounded-lg p-3">
            <p class="font-bold mb-1">{% if lang == 'fr' %}üé® Images d'arri√®re-plan{% else %}üé® Background Images{% endif %}:</p>
            <p>{% if lang == 'fr' %}Pour les images en fond avec opacit√© et gradients{% else %}For background images with opacity and gradients{% endif %}</p>
        </div>
        
        <div class="bg-white rounded-lg p-3">
            <p class="font-bold mb-1">{% if lang == 'fr' %}üåç Gestion multilingue{% else %}üåç Multilingual Management{% endif %}:</p>
            <p>{% if lang == 'fr' %}Cr√©ez deux sections identiques (m√™me type, m√™me ordre) avec contenus FR et EN s√©par√©s{% else %}Create two identical sections (same type, same order) with separate FR and EN content{% endif %}</p>
        </div>
        
        <div class="bg-white rounded-lg p-3">
            <p class="font-bold mb-1">{% if lang == 'fr' %}üìÅ Images disponibles{% else %}üìÅ Available Images{% endif %}:</p>
            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                <li>/static/images/modern_construction__a427a1cf.jpg</li>
                <li>/static/images/modern_construction__e4781d44.jpg</li>
                <li>/static/images/professional_electri_984ae0e8.jpg</li>
                <li>/static/images/plumber_fixing_pipes_d4c8be18.jpg</li>
                <li>/static/images/painter_painting_wal_be02294b.jpg</li>
                <li>/static/images/hvac_air_conditionin_8336dff9.jpg</li>
                <li>/static/images/swimming_pool_mainte_0698f0ec.jpg</li>
            </ul>
        </div>
    </div>
</div>

<script>
let currentLang = '{{ lang or "fr" }}';

function setLang(lang) {
    currentLang = lang;
    const url = new URL(window.location);
    url.searchParams.set('lang', lang);
    window.location = url.toString();
}

function showAddSection() {
    document.getElementById('addSectionForm').classList.remove('hidden');
}

function hideAddSection() {
    document.getElementById('addSectionForm').classList.add('hidden');
}

function filterSections() {
    const selectedLang = document.getElementById('languageFilter').value;
    const sections = document.querySelectorAll('.section-item');
    
    sections.forEach(section => {
        if (selectedLang === 'all' || section.dataset.language === selectedLang) {
            section.style.display = 'block';
        } else {
            section.style.display = 'none';
        }
    });
}

function showResolution(img, targetId) {
    const target = document.getElementById(targetId);
    if (target && img.naturalWidth && img.naturalHeight) {
        target.innerHTML = `<span class="resolution-badge">${img.naturalWidth} √ó ${img.naturalHeight}px</span>`;
    }
}
</script>
{% endblock %}
